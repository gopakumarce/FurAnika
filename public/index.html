<html>
<head>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #F0F0F0;
    }
  </style>
  <script src="https://cdn.firebase.com/js/client/2.2.1/firebase.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
  <script src="konva.min.js"></script>
</head>

<body>

<div id='container'></div>

<script>

  var width = window.innerWidth;
  var height = window.innerHeight;

  /*
   * The actual play baord related parameters. The board is a 7-column
   * 6-row board
   */
  var boardRows = 6;
  var boardColumns = 7;
  var boardHands = 3; // Number of cards in my hand
  var boardTop = 8; // Start 8 pixels from top
  var boardLeft = 8;  // Start 8 pixels from left
  var boardToHandSpace = 4;
  var emptyHand = 'yoda.jpg';
  /* 
   * forumla is as below, leaving boardToHandSpace between board and the hand (boardHands)
   * width = boardLeft + boardColumns*boardCellWide + boardToHandSpace + 
   *         boardHands*boardCellWide + boardLeft
   */
  var boardCellWide = Math.floor((width - (boardToHandSpace+2*boardLeft))/(boardColumns+boardHands));
  /*
   * Leave boardTop space above and below
   */
  var boardCellHigh = Math.floor((height - 2*boardTop)/boardRows);
  var boardCell = Math.min(boardCellWide,boardCellHigh);
  /*
   * The three hands are in a row next to each other, the usedHands are right
   * below that and opponent's oppUsedHands are below that and unusedCards below that,
   * all equally spaced from the top and bottom and between each of them
   * so the spacing formula is height = (4*space + 4*boardCell)
   */
  var cardStackSeperation = Math.floor((height - 4*boardCell)/5);

  var imageObj = new Image();
  
  var stage = new Konva.Stage({
    container: 'container',
    width: width,
    height: height
  });

  var layer = new Konva.Layer();

  /*
  * create a group which will be used to combine
  * multiple simple shapes.  Transforming the group will
  * transform all of the simple shapes together as
  * one unit
  */
  var group = new Konva.Group({
      x: boardLeft,
      y: boardTop,
      rotation: 0
  });

  var images = [
                ['yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg'], 
                ['yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg'], 
                ['yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg'], 
                ['yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg'], 
                ['yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg'], 
                ['yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg', 'yoda.jpg']
               ];                


  var imageObjs = [];

  function cellImage(row, column) {
      var cell = new Konva.Image({
          x: boardLeft + (column * boardCell),
          y: boardTop + (row * boardCell),
          image: imageObjs[row][column],
          width: boardCell,
          height: boardCell
      });
      group.add(cell);
      cell.draw();
  }

  for(var row = 0; row < boardRows; row++) {
      imageObjs[row] = [];
      for(var column = 0; column < boardColumns; column++) {
          cellImageSpecific = cellImage.bind(null, row, column)
          imageObjs[row][column] = new Image();
          imageObjs[row][column].onload = cellImageSpecific;
          imageObjs[row][column].src = images[row][column];
          if (imageObjs[row][column].complete) {
              $(imageObjs[row][column]).load();
          }
      }
  }

  var myHand = [];
  var firstHand = boardLeft + boardColumns*boardCell + boardToHandSpace*boardLeft;

  function setHand(hand, imageSrc) {
      var image = new Image();
      image.onload = function () {
          myHand[hand].image(image);
          myHand[hand].draw();
      }    
      image.src = imageSrc;
      if (image.complete) {
          $(image).load();
      }
  }

  for (var hand = 0; hand < boardHands; hand++) {
      myHand[hand] = new Konva.Image({
          x: firstHand + (hand*boardCell),
          y: cardStackSeperation,
          width: boardCell,
          height: boardCell
      });
      // Start with empty hand
      layer.add(myHand[hand]);
      setHand(hand, emptyHand);
  }

  /*
   * Align this in the middle below the second of the three hands (0, 1, 2)
   */
  var usedHand = new Konva.Image({
          x: firstHand + boardCell,
          y: cardStackSeperation + boardCell + cardStackSeperation,
          width: boardCell,
          height: boardCell});

  function setUsedHand(imageSrc) {
      var image = new Image();
      image.onload = function () {
          usedHand.image(image)
          usedHand.draw();
      }    
      image.src = imageSrc;
      if (image.complete) {
          $(image).load();
      }
  }
  layer.add(usedHand);
  // Start with emptyHand
  setUsedHand(emptyHand);

  /*
   * Align this in the middle below the second of the three hands (0, 1, 2)
   */
  var unusedCards = new Konva.Image({
          x: firstHand + boardCell,
          y: cardStackSeperation + 2*boardCell + 2*cardStackSeperation,
          width: boardCell,
          height: boardCell});

  function setUnusedCards(imageSrc) {
      var image = new Image();
      image.onload = function () {
          unusedCards.image(image);
          unusedCards.draw();
      }    
      image.src = imageSrc;
      if (image.complete) {
          $(image).load();
      }
  }
  layer.add(unusedCards);
  // Start with emptyHand
  setUnusedCards(emptyHand);

  /*
   * Align this in the middle below the second of the three hands (0, 1, 2)
   */
  var oppUsedHand = new Konva.Image({
          x: firstHand + boardCell,
          y: cardStackSeperation + 3*boardCell + 3*cardStackSeperation,
          width: boardCell,
          height: boardCell});

  function setOppUsedHand(imageSrc) {
      var image = new Image();
      image.onload = function () {
          oppUsedHand.image(image);
          oppUsedHand.draw();
      }    
      image.src = imageSrc;
      if (image.complete) {
          $(image).load();
      }
  }
  layer.add(oppUsedHand);
  // Start with emptyHand
  setOppUsedHand(emptyHand);

  layer.add(group);
  stage.add(layer);


</script>
</body>
</html>
